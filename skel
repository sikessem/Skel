#!/usr/bin/php --
<?php

require_once __DIR__ . '/cfg/_init.php';

$input = $argv[1] ?? '';

while(!is_readable($path = SRC_DIR . $input . SRC_EXT))
  $input = readline('Enter an existing file in the source directory : ');

$f = @fopen($path, 'r');

$code = '';

while(!feof($f)) {
  $c = fgetc($f);
  if($c === ' ' || preg_match('/^[\r\n\t\s]$/', $c)) {
    $valid = false;
    if(in_array($code, KEYWORDS)) $valid = true;
    else foreach(PATTERNS as $name => $pattern) {
      if(preg_match("/^$pattern$/", $code)) {
        $valid = true;
        break;
      }
    }
    if($valid) {
      token($code);
    } else {
      error($code);
    }
    $code = '';
    continue;
  }
  $code .= $c;
}

function token(string $token) {
  echo "Token: $token" . PHP_EOL;
}

function error(string $error) {
  fputs(STDERR, $error);
  exit(1);
}


fclose($f);
